# ğŸ—ï¸ Trimly Architecture - Visual Guide

**Visual diagrams to help you understand how Trimly works**

---

## ğŸ¯ System Architecture (High Level)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER DEVICES                            â”‚
â”‚  ğŸ“± Mobile Browser          ğŸ’» Desktop Browser              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND (React App)                      â”‚
â”‚  /App.tsx  +  /components/*  +  /utils/*                   â”‚
â”‚                                                             â”‚
â”‚  Features:                                                  â”‚
â”‚  â€¢ Customer Dashboard    â€¢ Barber Dashboard                â”‚
â”‚  â€¢ Booking System        â€¢ Profile Management              â”‚
â”‚  â€¢ Search & Filters      â€¢ Services CRUD                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP/REST API
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            BACKEND (Supabase Edge Function)                 â”‚
â”‚         /supabase/functions/server/index.tsx                â”‚
â”‚                                                             â”‚
â”‚  Web Server: Hono                                          â”‚
â”‚  Endpoints: 15 REST APIs                                   â”‚
â”‚  Auth: Custom session tokens                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ SQL Queries
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Supabase PostgreSQL)                 â”‚
â”‚                                                             â”‚
â”‚  Tables (8):                                               â”‚
â”‚  â€¢ customers        â€¢ barbers         â€¢ services           â”‚
â”‚  â€¢ barber_slots     â€¢ bookings        â€¢ favorites          â”‚
â”‚  â€¢ sessions         â€¢ v_available_slots_by_barber (view)   â”‚
â”‚                                                             â”‚
â”‚  Security: Row Level Security (RLS) policies               â”‚
â”‚  Functions: hash_password(), verify_password()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚
â”‚   or Barber  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Enter phone + password
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (App.tsx)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. POST /auth/login
       â”‚    { phone, password }
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (auth-service.tsx)    â”‚
â”‚                                â”‚
â”‚  3. Query database:            â”‚
â”‚     SELECT * FROM customers    â”‚
â”‚     WHERE phone = ?            â”‚
â”‚                                â”‚
â”‚  4. Verify password:           â”‚
â”‚     verify_password(           â”‚
â”‚       input, password_hash     â”‚
â”‚     )                          â”‚
â”‚                                â”‚
â”‚  5. Create session:            â”‚
â”‚     INSERT INTO sessions       â”‚
â”‚     Generate session token     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 6. Return session token
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (App.tsx)   â”‚
â”‚                        â”‚
â”‚  7. Store in localStorage:    â”‚
â”‚     trimly_session_token       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… Booking Flow (Customer â†’ Barber)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer    â”‚
â”‚   Selects:    â”‚
â”‚   â€¢ Barber    â”‚
â”‚   â€¢ Service   â”‚
â”‚   â€¢ Date/Time â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1. Check availability
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Query:             â”‚
â”‚  SELECT * FROM               â”‚
â”‚  v_available_slots_by_barber â”‚
â”‚  WHERE barber_id = ?         â”‚
â”‚  AND slot_date = ?           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 2. Customer confirms booking
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /bookings              â”‚
â”‚  {                           â”‚
â”‚    barber_id,                â”‚
â”‚    customer_id,              â”‚
â”‚    slot_id,                  â”‚
â”‚    service_id,               â”‚
â”‚    date, time, price         â”‚
â”‚  }                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 3. Backend processes
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (index.tsx):                â”‚
â”‚                                      â”‚
â”‚  Transaction:                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. INSERT INTO bookings     â”‚   â”‚
â”‚  â”‚ 2. UPDATE barber_slots      â”‚   â”‚
â”‚  â”‚    SET status = 'booked'    â”‚   â”‚
â”‚  â”‚ 3. COMMIT                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 4. Return booking with joined data
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Updates UI:    â”‚
â”‚  â€¢ Add to bookings list  â”‚
â”‚  â€¢ Show confirmation     â”‚
â”‚  â€¢ Send notification     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database Schema (Relationships)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     customers       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â€¢ id (PK)          â”‚
â”‚ â€¢ phone (unique)   â”‚
â”‚ â€¢ full_name        â”‚
â”‚ â€¢ password_hash    â”‚
â”‚ â€¢ created_at       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1:N (one customer â†’ many bookings)
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              bookings                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â€¢ id (PK)                              â”‚
â”‚ â€¢ booking_code (unique)                â”‚
â”‚ â€¢ barber_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â€¢ customer_id (FK)           â”‚         â”‚
â”‚ â€¢ slot_id (FK) â”€â”€â”€â”€â”€â”€â”       â”‚         â”‚
â”‚ â€¢ service_id (FK) â”€â” â”‚       â”‚         â”‚
â”‚ â€¢ date, time       â”‚ â”‚       â”‚         â”‚
â”‚ â€¢ status, price    â”‚ â”‚       â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ â”‚       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚
          â”‚            â”‚       â”‚
          â†“            â†“       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  services   â”‚  â”‚barber    â”‚  â”‚  barbers    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚_slots    â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â€¢ id (PK)  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â€¢ id (PK)  â”‚
â”‚ â€¢ barber_idâ”‚â†â”€â”‚â€¢ id (PK)  â”‚â†â”€â”‚ â€¢ phone    â”‚
â”‚ â€¢ name     â”‚  â”‚â€¢ barber_idâ”‚  â”‚ â€¢ full_nameâ”‚
â”‚ â€¢ duration â”‚  â”‚â€¢ slot_dateâ”‚  â”‚ â€¢ password_â”‚
â”‚ â€¢ price    â”‚  â”‚â€¢ time     â”‚  â”‚   hash     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â€¢ status   â”‚  â”‚ â€¢ bio      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ avatar   â”‚
                               â”‚ â€¢ districtsâ”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ languagesâ”‚
                â”‚              â”‚ â€¢ gallery  â”‚
                â”‚              â”‚ â€¢ price_   â”‚
                â”‚              â”‚   range    â”‚
                â”‚              â”‚ â€¢ subscrip-â”‚
                â”‚              â”‚   tion     â”‚
                â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ 1:N (one customer â†’ many favorites)
                â”‚
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  favorites   â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
         â”‚ â€¢ id (PK)   â”‚
         â”‚ â€¢ customer_idâ”‚
         â”‚ â€¢ barber_id  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Profile Update (Barber)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Barber Dashboard  â”‚
â”‚  Edit Profile Form â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 1. User fills form:
          â”‚    â€¢ Name, bio, avatar
          â”‚    â€¢ Languages, districts
          â”‚    â€¢ Gallery images
          â”‚    â€¢ Services list
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend validates data  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 2. Two API calls:
          â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                             â”‚
          â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUT /barber-profile  â”‚      â”‚ POST /barbers/:id/   â”‚
â”‚                      â”‚      â”‚      services        â”‚
â”‚ Update:              â”‚      â”‚                      â”‚
â”‚ â€¢ name, bio          â”‚      â”‚ Update:              â”‚
â”‚ â€¢ avatar, gallery    â”‚      â”‚ â€¢ services[]         â”‚
â”‚ â€¢ districts[]        â”‚      â”‚   - name             â”‚
â”‚ â€¢ languages[]        â”‚      â”‚   - duration         â”‚
â”‚ â€¢ price range        â”‚      â”‚   - price            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â”‚ 3. Backend processes        â”‚
          â”‚                             â”‚
          â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE barbers       â”‚      â”‚ DELETE FROM services â”‚
â”‚ SET                  â”‚      â”‚ WHERE barber_id = ?  â”‚
â”‚   full_name = ?,     â”‚      â”‚                      â”‚
â”‚   bio = ?,           â”‚      â”‚ INSERT INTO services â”‚
â”‚   avatar = ?,        â”‚      â”‚ VALUES (...)         â”‚
â”‚   ...                â”‚      â”‚ (for each service)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â”‚ 4. Return success           â”‚
          â”‚                             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Frontend:       â”‚
          â”‚ â€¢ Update state  â”‚
          â”‚ â€¢ Show success  â”‚
          â”‚ â€¢ Refetch data  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Slot Management System

```
Slot Lifecycle:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. CREATED (available)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Barber creates:    â”‚
   â”‚  â€¢ Date: 2024-01-15 â”‚
   â”‚  â€¢ Time: 09:00      â”‚
   â”‚  â€¢ Duration: 30 min â”‚
   â”‚  â€¢ Status: availableâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ INSERT INTO barber_slotsâ”‚
   â”‚ (barber_id, slot_date,  â”‚
   â”‚  start_time, end_time,  â”‚
   â”‚  status = 'available')  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“

2. DISPLAYED (to customers)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SELECT * FROM            â”‚
   â”‚ v_available_slots_by_    â”‚
   â”‚ barber                   â”‚
   â”‚ WHERE status='available' â”‚
   â”‚ AND slot_date >= TODAY   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“

3. BOOKED (customer books)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Transaction:            â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚ INSERT booking      â”‚ â”‚
   â”‚ â”‚ UPDATE slot         â”‚ â”‚
   â”‚ â”‚ SET status='booked' â”‚ â”‚
   â”‚ â”‚ booked_by=customer  â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“

4. FREED (booking cancelled)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Transaction:            â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚ DELETE booking      â”‚ â”‚
   â”‚ â”‚ UPDATE slot         â”‚ â”‚
   â”‚ â”‚ SET status=         â”‚ â”‚
   â”‚ â”‚   'available'       â”‚ â”‚
   â”‚ â”‚ booked_by=NULL      â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“

5. DELETED (barber removes)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ DELETE FROM barber_slotsâ”‚
   â”‚ WHERE id = ?            â”‚
   â”‚ (only if not booked)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security: Row Level Security (RLS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RLS POLICIES                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š BARBERS TABLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT: Everyone can view                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (true) â†’ No restrictions                    â”‚
â”‚                                                   â”‚
â”‚ UPDATE: Barbers can update own data              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (auth.uid() = id)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ‘¤ CUSTOMERS TABLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT: Users can view own data                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (auth.uid() = id)                          â”‚
â”‚                                                   â”‚
â”‚ UPDATE: Users can update own data                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (auth.uid() = id)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ BOOKINGS TABLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT: View own bookings                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (                                          â”‚
â”‚   auth.uid() = barber_id OR                     â”‚
â”‚   auth.uid() = customer_id                      â”‚
â”‚ )                                                â”‚
â”‚                                                   â”‚
â”‚ INSERT: Barbers can create any booking          â”‚
â”‚         Customers can create own bookings        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ WITH CHECK (                                     â”‚
â”‚   auth.uid() = barber_id OR                     â”‚
â”‚   (auth.uid() = customer_id                     â”‚
â”‚    AND customer_id IS NOT NULL)                 â”‚
â”‚ )                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ—“ï¸ BARBER_SLOTS TABLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SELECT: Everyone can view                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (true)                                     â”‚
â”‚                                                   â”‚
â”‚ INSERT/UPDATE/DELETE: Only own slots             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ USING (auth.uid() = barber_id)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Component Hierarchy

```
App.tsx
â”œâ”€â”€ LanguageProvider
â”‚   â””â”€â”€ AppContent
â”‚       â”œâ”€â”€ Navbar
â”‚       â”‚   â”œâ”€â”€ LanguageSelector
â”‚       â”‚   â””â”€â”€ ProfileMenu
â”‚       â”‚
â”‚       â”œâ”€â”€ AuthViews (if not logged in)
â”‚       â”‚   â”œâ”€â”€ LoginPage
â”‚       â”‚   â”œâ”€â”€ SignUpPage
â”‚       â”‚   â””â”€â”€ OTPVerificationPage
â”‚       â”‚
â”‚       â”œâ”€â”€ CustomerDashboard (if role=customer)
â”‚       â”‚   â”œâ”€â”€ SearchPage
â”‚       â”‚   â”‚   â”œâ”€â”€ SearchFilters
â”‚       â”‚   â”‚   â””â”€â”€ BarberCard[]
â”‚       â”‚   â”œâ”€â”€ BookingsPage
â”‚       â”‚   â”‚   â””â”€â”€ BookingCard[]
â”‚       â”‚   â”œâ”€â”€ FavoritesPage
â”‚       â”‚   â”‚   â””â”€â”€ BarberCard[]
â”‚       â”‚   â””â”€â”€ ProfilePage
â”‚       â”‚       â””â”€â”€ CustomerProfileEditor
â”‚       â”‚
â”‚       â”œâ”€â”€ BarberDashboard (if role=barber)
â”‚       â”‚   â”œâ”€â”€ HomePage
â”‚       â”‚   â”‚   â”œâ”€â”€ StatCard[]
â”‚       â”‚   â”‚   â””â”€â”€ BookingCard[]
â”‚       â”‚   â”œâ”€â”€ CalendarPage
â”‚       â”‚   â”‚   â””â”€â”€ ScheduleCalendar
â”‚       â”‚   â”œâ”€â”€ ManualBookingPage
â”‚       â”‚   â”‚   â””â”€â”€ ManualBookingForm
â”‚       â”‚   â””â”€â”€ ProfilePage
â”‚       â”‚       â”œâ”€â”€ BarberProfileEditor
â”‚       â”‚       â”œâ”€â”€ ServicesManager
â”‚       â”‚       â””â”€â”€ SubscriptionManagement
â”‚       â”‚
â”‚       â”œâ”€â”€ BookingModal
â”‚       â”‚   â””â”€â”€ Service selection + time slots
â”‚       â”‚
â”‚       â”œâ”€â”€ SupabaseDebugBanner
â”‚       â”‚
â”‚       â”œâ”€â”€ Toaster (notifications)
â”‚       â”‚
â”‚       â””â”€â”€ Footer
```

---

## ğŸ“¦ File Structure

```
/
â”œâ”€â”€ App.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main app component
â”‚
â”œâ”€â”€ /components/
â”‚   â”œâ”€â”€ AuthSetupRequired.tsx
â”‚   â”œâ”€â”€ BarberCard.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€ Barber list item
â”‚   â”œâ”€â”€ BarberDashboard.tsx â”€â”€â”€â”€ Barber main view
â”‚   â”œâ”€â”€ BarberProfileEditor.tsx â”€ Barber profile form
â”‚   â”œâ”€â”€ BookingCard.tsx â”€â”€â”€â”€â”€â”€â”€â”€ Booking list item
â”‚   â”œâ”€â”€ BookingModal.tsx â”€â”€â”€â”€â”€â”€â”€ Booking creation modal
â”‚   â”œâ”€â”€ CustomerDashboard.tsx â”€â”€ Customer main view
â”‚   â”œâ”€â”€ CustomerProfileEditor.tsx
â”‚   â”œâ”€â”€ FavoritesPage.tsx
â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”œâ”€â”€ ManualBookingForm.tsx â”€â”€ Walk-in bookings
â”‚   â”œâ”€â”€ Navbar.tsx
â”‚   â”œâ”€â”€ OTPVerificationPage.tsx
â”‚   â”œâ”€â”€ ScheduleCalendar.tsx â”€â”€â”€ Barber calendar
â”‚   â”œâ”€â”€ SearchFilters.tsx
â”‚   â”œâ”€â”€ ServicesManager.tsx â”€â”€â”€â”€ Services CRUD
â”‚   â”œâ”€â”€ SignUpPage.tsx
â”‚   â”œâ”€â”€ SubscriptionManagement.tsx
â”‚   â””â”€â”€ /ui/ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Shadcn components
â”‚
â”œâ”€â”€ /contexts/
â”‚   â””â”€â”€ LanguageContext.tsx â”€â”€â”€â”€ i18n support
â”‚
â”œâ”€â”€ /supabase/
â”‚   â””â”€â”€ /functions/server/
â”‚       â”œâ”€â”€ index.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main API server
â”‚       â”œâ”€â”€ auth-service.tsx â”€â”€â”€ Auth logic
â”‚       â”œâ”€â”€ otp-service.tsx â”€â”€â”€â”€ OTP logic
â”‚       â””â”€â”€ kv_store.tsx â”€â”€â”€â”€â”€â”€â”€ KV utilities
â”‚
â”œâ”€â”€ /utils/
â”‚   â”œâ”€â”€ /supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Supabase client
â”‚   â”‚   â””â”€â”€ info.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Project config
â”‚   â”œâ”€â”€ bookingFlow.ts
â”‚   â”œâ”€â”€ generateBookingId.ts
â”‚   â”œâ”€â”€ priceUtils.ts
â”‚   â””â”€â”€ scheduleUtils.ts
â”‚
â”œâ”€â”€ /types/
â”‚   â””â”€â”€ index.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TypeScript types
â”‚
â””â”€â”€ /styles/
    â””â”€â”€ globals.css â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Tailwind styles
```

---

## ğŸš€ Request Flow Example

### Example: Customer Books a Haircut

```
1ï¸âƒ£ USER ACTION
   Customer clicks "Book" on barber card
   
   â†“

2ï¸âƒ£ FRONTEND
   â€¢ Opens BookingModal
   â€¢ Fetches available slots:
     GET /api/slots?barber_id=xxx&date=2024-01-15
   
   â†“

3ï¸âƒ£ BACKEND (Supabase Edge Function)
   â€¢ Receives request
   â€¢ Validates session token
   â€¢ Queries database:
     SELECT * FROM v_available_slots_by_barber
     WHERE barber_id = ? AND slot_date = ?
   
   â†“

4ï¸âƒ£ DATABASE
   â€¢ Executes query
   â€¢ Returns available slots
   
   â†“

5ï¸âƒ£ BACKEND
   â€¢ Formats response
   â€¢ Returns slots to frontend
   
   â†“

6ï¸âƒ£ FRONTEND
   â€¢ Displays available time slots
   â€¢ Customer selects slot
   â€¢ Customer clicks "Confirm"
   
   â†“

7ï¸âƒ£ FRONTEND
   â€¢ Sends booking request:
     POST /bookings
     {
       barber_id, customer_id, slot_id,
       service_id, date, time, price
     }
   
   â†“

8ï¸âƒ£ BACKEND
   â€¢ Validates session
   â€¢ Starts database transaction
   
   â†“

9ï¸âƒ£ DATABASE TRANSACTION
   BEGIN;
   â€¢ INSERT INTO bookings (...)
   â€¢ UPDATE barber_slots
     SET status = 'booked'
     WHERE id = slot_id
   COMMIT;
   
   â†“

ğŸ”Ÿ BACKEND
   â€¢ Joins barber + customer data
   â€¢ Returns complete booking object
   
   â†“

1ï¸âƒ£1ï¸âƒ£ FRONTEND
   â€¢ Updates local state
   â€¢ Shows success toast
   â€¢ Closes modal
   â€¢ Refreshes booking list
   
   âœ… BOOKING COMPLETE!
```

---

**Visual guide complete!** ğŸ¨

Use these diagrams to understand how Trimly works under the hood.

For setup instructions, see:
- [QUICK_SETUP_CHECKLIST.md](/QUICK_SETUP_CHECKLIST.md)
- [START_HERE.md](/START_HERE.md)
